<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head>
    <script src="/drapo.js"></script>
    <title>Container Removal Error Test</title>
</head>
<body>
    <span>Container Removal Error Test</span>
    
    <!-- Explorer sector -->
    <div d-sector="@">
        <div d-datakey="showForm" d-datatype="object" style="display: none;">false</div>
        <button d-on-click="UpdateDataField('showForm', '', true)">Open Form</button>
        
        <!-- Form container that gets loaded/unloaded -->
        
    </div>
    
    <!-- Test multiple open/close cycles -->
    <div>
        <input type="button" driverunittest="click" value="Auto Test" d-on-click="TestCycle()">
    </div>
    
    <!-- Test function -->
    <div d-datakey="testData" d-datatype="object" style="display: none;">{"cycle": 0, "maxCycles": 5}</div>
    
    <script>
        function TestCycle() {
            const app = drapo.application;
            const cycles = 3; // Test 3 cycles of open/close
            
            function runCycle(i) {
                if (i >= cycles) return;
                
                setTimeout(() => {
                    // Open form
                    app.Storage.UpdateDataField('explorer', 'showForm', '', true);
                    
                    setTimeout(() => {
                        // Close form
                        app.Storage.UpdateDataField('explorer', 'showForm', '', false);
                        
                        setTimeout(() => {
                            runCycle(i + 1);
                        }, 500);
                    }, 500);
                }, 500);
            }
            
            runCycle(0);
        }
    </script>

</body></html>