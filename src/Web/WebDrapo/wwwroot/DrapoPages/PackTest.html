<!DOCTYPE html>
<html>
<head>
    <script src="/drapo.js"></script>
    <title>Pack Test</title>
</head>
<body>
    <div d-datakey="packData" d-datatype="object">
        {
            "packName": "testpack",
            "loaded": false,
            "message": "Pack not loaded yet",
            "componentLoaded": false
        }
    </div>

    <div d-sector="content">
        <h1>Pack Loading Test</h1>
        
        <div class="status">
            <p>Status: {{packData.message}}</p>
            <p d-if="{{packData.loaded}}">Pack has been loaded successfully!</p>
            <p d-if="{{packData.componentLoaded}}">Component from pack is now active and ready to use!</p>
        </div>

        <button d-on-click="LoadPack({{packData.packName}});UpdateDataField(packData,loaded,true);UpdateDataField(packData,message,'Pack loaded!')">
            Load Pack
        </button>

        <button d-if="{{packData.loaded}}" d-on-click="UpdateSector(componenttest,~/testpack/component-test-page.html);UpdateDataField(packData,componentLoaded,true)" style="margin-left: 10px;">
            Load Component from Pack
        </button>

        <div class="test-area pack-loaded" style="margin-top: 20px;">
            <p class="pack-test-style">This should be styled by the pack CSS when loaded.</p>
            <p id="js-test-result">JavaScript test result will appear here.</p>
        </div>

        <!-- Sector where the component will be loaded -->
        <div d-sector="componenttest" style="margin-top: 20px; padding: 15px; border: 2px dashed #ccc; min-height: 50px;">
            <p style="color: #999; font-style: italic;">Component will appear here after loading pack and clicking "Load Component from Pack"</p>
        </div>

        <div style="margin-top: 20px; padding: 15px; background-color: #f0f0f0; border-radius: 5px;">
            <h3>Test Instructions:</h3>
            <ol>
                <li><strong>Load Pack:</strong> Click "Load Pack" to load the test pack containing component files</li>
                <li><strong>Load Component:</strong> Click "Load Component from Pack" to load a sector that uses the component from the pack</li>
                <li><strong>Verify:</strong> The component should load without fetching files from server again (check browser network tab)</li>
                <li><strong>Interact:</strong> Use the increment/reset buttons to verify the component works correctly</li>
            </ol>
            <p><em>This demonstrates that components loaded via packs are properly marked as active and don't cause duplicate loading.</em></p>
        </div>

        <script>
            // Test if pack JavaScript was loaded
            function checkPackJavaScript() {
                var result = document.getElementById('js-test-result');
                if (window.packJsLoaded && typeof testPackFunction === 'function') {
                    result.textContent = testPackFunction();
                } else {
                    result.textContent = 'Pack JavaScript not loaded yet.';
                }
            }
            
            // Check periodically
            setInterval(checkPackJavaScript, 1000);
            checkPackJavaScript();
        </script>
    </div>
</body>
</html>